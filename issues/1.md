---

## Summary
The deployment job failed due to a timing/dependency issue where role assignment resources are being created before the managed identities (from container apps/jobs) are fully available in Azure AD. This problem surfaced in the recent workflow run: https://github.com/adiazcan/recall-core/actions/runs/21530534082/job/62045102289. The failure often manifests as a generic ARM DeploymentFailed error.

## Details
When assigning roles using Bicep (e.g., in `storage-roles.bicep`, `container-app-api.bicep`, `container-app-job.bicep`), Azure may not immediately propagate MSI principalIds, causing the ARM deployment for those role assignments to fail.

## Proposed Solution
- Add explicit `dependsOn` clauses wherever role assignments are made to ensure the target resource (container app/job) is fully deployed before assigning roles to its managed identity.
- See discussion and code excerpt in chat history for examples of correct usage.

## Next Actions
- Refactor the main Bicep deployment and affected modules to include explicit dependencies as described above.
- Test the deployment via GitHub Actions.

---